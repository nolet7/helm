# ==========================================================
# Linkerd Control Plane Helm Values - Development Environment
# Managed via Argo CD + Kustomize
# External Repo: WEBFORX/helm-charts (feature/531-team-panthers-linkerd-helm)
# ==========================================================

# ----------------------------------------------------------
# Namespace & Installation
# ----------------------------------------------------------
installNamespace: false
enablePodAntiAffinity: true
enableEndpointSlices: true
autoInject: true

# ----------------------------------------------------------
# Identity and mTLS (Option B - Auto-generated certs)
# ----------------------------------------------------------
identityTrustAnchorsPEM: ""
identity:
  issuer:
    scheme: kubernetes.io/tls
  clockSkewAllowance: "20s"
  issuerLifetime: "24h"
  # cert-manager can be integrated later if needed
  certManager: false

# ----------------------------------------------------------
# Proxy Configuration
# ----------------------------------------------------------
proxy:
  image:
    name: cr.l5d.io/linkerd/proxy
    version: stable-2.14.10
  logLevel: warn,linkerd=info
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi
  livenessProbe:
    periodSeconds: 10
    failureThreshold: 3
  readinessProbe:
    periodSeconds: 5
    failureThreshold: 3
  lifecycle:
    postStartSleepSeconds: 2

# ----------------------------------------------------------
# Controller Plane Configuration
# ----------------------------------------------------------
controllerReplicas: 2

controllerResources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# ----------------------------------------------------------
# Destination & Identity Services
# ----------------------------------------------------------
destinationControllerResources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 400m
    memory: 256Mi

identityResources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 300m
    memory: 256Mi

# ----------------------------------------------------------
# Proxy Injector & Tap Injector
# ----------------------------------------------------------
proxyInjector:
  resources:
    requests:
      cpu: 100m
      memory: 100Mi
    limits:
      cpu: 300m
      memory: 200Mi
  replicas: 1

policyController:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi

tap:
  enabled: true
  resources:
    requests:
      cpu: 150m
      memory: 128Mi
    limits:
      cpu: 400m
      memory: 256Mi

# ----------------------------------------------------------
# Telemetry & Metrics (integrated with Linkerd Viz)
# ----------------------------------------------------------
metrics:
  enabled: true
  scrapeInterval: 10s
  retentionTime: 2h

# ----------------------------------------------------------
# Control Plane Tuning
# ----------------------------------------------------------
heartbeatSchedule: "*/5 * * * *"
heartbeatResources:
  requests:
    cpu: 50m
    memory: 50Mi

# ----------------------------------------------------------
# HA / Node Affinity
# ----------------------------------------------------------
highAvailability:
  enabled: true
  replicas: 2
  antiAffinity: soft

# ----------------------------------------------------------
# Logging
# ----------------------------------------------------------
logLevel: warn,linkerd=info

# ----------------------------------------------------------
# Tracing (optional)
# ----------------------------------------------------------
tracing:
  enabled: false
  collector:
    resources:
      requests:
        cpu: 50m
        memory: 64Mi

# ----------------------------------------------------------
# Addons for Viz Integration
# ----------------------------------------------------------
grafana:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 256Mi

prometheus:
  enabled: true
  retention: 6h
  scrapeInterval: 10s
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 600m
      memory: 512Mi

tapInjector:
  enabled: true

# ----------------------------------------------------------
# Resource Defaults (Catch-all)
# ----------------------------------------------------------
global:
  clusterDomain: cluster.local
  proxy:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 300m
        memory: 256Mi

# ==========================================================
# END OF FILE
# ==========================================================
